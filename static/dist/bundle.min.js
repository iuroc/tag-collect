(function(){(function(){function l(a,i,s){function u(r,e){if(!i[r]){if(!a[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(c)return c(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var o=i[r]={exports:{}};a[r][0].call(o.exports,function(e){var t=a[r][1][e];return u(t||e)},o,o.exports,l,a,i,s)}return i[r].exports}for(var c="function"==typeof require&&require,e=0;e<s.length;e++)u(s[e]);return u}return l})()({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.Router=void 0;var n=function(){function e(e){this.routeList={};this.hashChanged=false;if(e===null||e===void 0?void 0:e.default)this.setDefaultRoute(e.default);if(e===null||e===void 0?void 0:e.routeSet)this.setRouteOption(e.routeSet)}e.prototype.setRouteOption=function(e){var t=this;if(!Array.isArray(e))throw new Error("routeSet 类型错误");e.forEach(function(e){if(typeof e=="string")t.set(e);else if(Array.isArray(e)){if(e.length==2&&typeof e[1]!="string")t.set.apply(t,e);else t.set(e)}else{throw new Error("routeSet 类型错误")}})};e.prototype.setDefaultRoute=function(e){if(typeof e=="string")this.defaultRoute=this.set(e)[0];else if(Array.isArray(e))this.defaultRoute=this.set.apply(this,e)[0];else throw new Error("default 选项类型错误")};e.prototype.set=function(e,t){var r;var n=Array.isArray(e)?e:[e];var o=[];for(var a=0;a<n.length;a++){var i=n[a];var s=t?Array.isArray(t)?t:[t]:[];var u=this.routeList[i];if(u){(r=u.event).push.apply(r,s);o.push(u);continue}var c=this.getRouteDom(i);if(!c)throw new Error('data-route="'.concat(i,'" 的 HTML 元素没有找到'));var l=this.routeList[i]={name:i,event:s,dom:c,data:{},args:[],status:0};o.push(l)}return o};e.prototype.getRouteDom=function(e,t){if(t===void 0){t=false}var r;if(t&&e)r='[data-route]:not([data-route="'.concat(e,'"]');else r=e?'[data-route="'.concat(e,'"]'):"[data-route]";var n=document.querySelectorAll(r);if(e&&!t&&n.length==0)throw new Error("".concat(r," 元素不存在"));return e&&!t?n[0]:n};e.prototype.loadRoute=function(t,e){var r=this;if(e===void 0){e=[]}this.getRouteDom(t.name,true).forEach(function(e){e.style.display="none"});this.getRouteDom(t.name).style.display="block";t.args=e;t.event.forEach(function(e){return e(t,r)})};e.prototype.start=function(){var i=this;var s=this;var e=function(e){if(e)i.hashChanged=true;var t=(e===null||e===void 0?void 0:e.newURL)||location.href;var r=new URL(t).hash;var n=r.split("/").slice(2);if(r=="")return s.loadRoute(s.defaultRoute,n);var o=r.split("/")[1];var a=s.routeList[o];if(!a)return location.hash="";s.loadRoute(a,n)};if(!this.defaultRoute)this.setDefaultRoute("home");window.addEventListener("hashchange",e);e()};e.prototype.getNowRouteName=function(){return location.hash==""?this.defaultRoute.name:location.hash.split("/")[1]};e.util={show:function(e){if(!e)return;var t=e instanceof Node?[e]:e;t.forEach(function(e){return e.style.display="block"})},hide:function(e){if(!e)return;var t=e instanceof Node?[e]:e;t.forEach(function(e){return e.style.display="none"})}};return e}();r.Router=n;r.default=n},{}],2:[function(e,t,r){var n={utf8:{stringToBytes:function(e){return n.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(n.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(e.charCodeAt(r)&255);return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}};t.exports=n},{}],3:[function(e,t,r){(function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number){return r.rotl(e,8)&16711935|r.rotl(e,24)&4278255360}for(var t=0;t<e.length;t++)e[t]=r.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(Math.random()*256));return t},bytesToWords:function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<e.length*32;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++){t.push((e[r]>>>4).toString(16));t.push((e[r]&15).toString(16))}return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var t=[],r=0;r<e.length;r+=3){var n=e[r]<<16|e[r+1]<<8|e[r+2];for(var o=0;o<4;o++)if(r*8+o*6<=e.length*8)t.push(a.charAt(n>>>6*(3-o)&63));else t.push("=")}return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],r=0,n=0;r<e.length;n=++r%4){if(n==0)continue;t.push((a.indexOf(e.charAt(r-1))&Math.pow(2,-2*n+8)-1)<<n*2|a.indexOf(e.charAt(r))>>>6-n*2)}return t}};t.exports=r})()},{}],4:[function(e,t,r){t.exports=function(e){return e!=null&&(n(e)||o(e)||!!e._isBuffer)};function n(e){return!!e.constructor&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)}function o(e){return typeof e.readFloatLE==="function"&&typeof e.slice==="function"&&n(e.slice(0,0))}},{}],5:[function(e,t,r){(function(){var y=e("crypt"),m=e("charenc").utf8,w=e("is-buffer"),b=e("charenc").bin,S=function(e,t){if(e.constructor==String)if(t&&t.encoding==="binary")e=b.stringToBytes(e);else e=m.stringToBytes(e);else if(w(e))e=Array.prototype.slice.call(e,0);else if(!Array.isArray(e)&&e.constructor!==Uint8Array)e=e.toString();var r=y.bytesToWords(e),n=e.length*8,o=1732584193,a=-271733879,i=-1732584194,s=271733878;for(var u=0;u<r.length;u++){r[u]=(r[u]<<8|r[u]>>>24)&16711935|(r[u]<<24|r[u]>>>8)&4278255360}r[n>>>5]|=128<<n%32;r[(n+64>>>9<<4)+14]=n;var c=S._ff,l=S._gg,f=S._hh,d=S._ii;for(var u=0;u<r.length;u+=16){var v=o,h=a,p=i,g=s;o=c(o,a,i,s,r[u+0],7,-680876936);s=c(s,o,a,i,r[u+1],12,-389564586);i=c(i,s,o,a,r[u+2],17,606105819);a=c(a,i,s,o,r[u+3],22,-1044525330);o=c(o,a,i,s,r[u+4],7,-176418897);s=c(s,o,a,i,r[u+5],12,1200080426);i=c(i,s,o,a,r[u+6],17,-1473231341);a=c(a,i,s,o,r[u+7],22,-45705983);o=c(o,a,i,s,r[u+8],7,1770035416);s=c(s,o,a,i,r[u+9],12,-1958414417);i=c(i,s,o,a,r[u+10],17,-42063);a=c(a,i,s,o,r[u+11],22,-1990404162);o=c(o,a,i,s,r[u+12],7,1804603682);s=c(s,o,a,i,r[u+13],12,-40341101);i=c(i,s,o,a,r[u+14],17,-1502002290);a=c(a,i,s,o,r[u+15],22,1236535329);o=l(o,a,i,s,r[u+1],5,-165796510);s=l(s,o,a,i,r[u+6],9,-1069501632);i=l(i,s,o,a,r[u+11],14,643717713);a=l(a,i,s,o,r[u+0],20,-373897302);o=l(o,a,i,s,r[u+5],5,-701558691);s=l(s,o,a,i,r[u+10],9,38016083);i=l(i,s,o,a,r[u+15],14,-660478335);a=l(a,i,s,o,r[u+4],20,-405537848);o=l(o,a,i,s,r[u+9],5,568446438);s=l(s,o,a,i,r[u+14],9,-1019803690);i=l(i,s,o,a,r[u+3],14,-187363961);a=l(a,i,s,o,r[u+8],20,1163531501);o=l(o,a,i,s,r[u+13],5,-1444681467);s=l(s,o,a,i,r[u+2],9,-51403784);i=l(i,s,o,a,r[u+7],14,1735328473);a=l(a,i,s,o,r[u+12],20,-1926607734);o=f(o,a,i,s,r[u+5],4,-378558);s=f(s,o,a,i,r[u+8],11,-2022574463);i=f(i,s,o,a,r[u+11],16,1839030562);a=f(a,i,s,o,r[u+14],23,-35309556);o=f(o,a,i,s,r[u+1],4,-1530992060);s=f(s,o,a,i,r[u+4],11,1272893353);i=f(i,s,o,a,r[u+7],16,-155497632);a=f(a,i,s,o,r[u+10],23,-1094730640);o=f(o,a,i,s,r[u+13],4,681279174);s=f(s,o,a,i,r[u+0],11,-358537222);i=f(i,s,o,a,r[u+3],16,-722521979);a=f(a,i,s,o,r[u+6],23,76029189);o=f(o,a,i,s,r[u+9],4,-640364487);s=f(s,o,a,i,r[u+12],11,-421815835);i=f(i,s,o,a,r[u+15],16,530742520);a=f(a,i,s,o,r[u+2],23,-995338651);o=d(o,a,i,s,r[u+0],6,-198630844);s=d(s,o,a,i,r[u+7],10,1126891415);i=d(i,s,o,a,r[u+14],15,-1416354905);a=d(a,i,s,o,r[u+5],21,-57434055);o=d(o,a,i,s,r[u+12],6,1700485571);s=d(s,o,a,i,r[u+3],10,-1894986606);i=d(i,s,o,a,r[u+10],15,-1051523);a=d(a,i,s,o,r[u+1],21,-2054922799);o=d(o,a,i,s,r[u+8],6,1873313359);s=d(s,o,a,i,r[u+15],10,-30611744);i=d(i,s,o,a,r[u+6],15,-1560198380);a=d(a,i,s,o,r[u+13],21,1309151649);o=d(o,a,i,s,r[u+4],6,-145523070);s=d(s,o,a,i,r[u+11],10,-1120210379);i=d(i,s,o,a,r[u+2],15,718787259);a=d(a,i,s,o,r[u+9],21,-343485551);o=o+v>>>0;a=a+h>>>0;i=i+p>>>0;s=s+g>>>0}return y.endian([o,a,i,s])};S._ff=function(e,t,r,n,o,a,i){var s=e+(t&r|~t&n)+(o>>>0)+i;return(s<<a|s>>>32-a)+t};S._gg=function(e,t,r,n,o,a,i){var s=e+(t&n|r&~n)+(o>>>0)+i;return(s<<a|s>>>32-a)+t};S._hh=function(e,t,r,n,o,a,i){var s=e+(t^r^n)+(o>>>0)+i;return(s<<a|s>>>32-a)+t};S._ii=function(e,t,r,n,o,a,i){var s=e+(r^(t|~n))+(o>>>0)+i;return(s<<a|s>>>32-a)+t};S._blocksize=16;S._digestsize=16;t.exports=function(e,t){if(e===undefined||e===null)throw new Error("Illegal argument "+e);var r=y.wordsToBytes(S(e,t));return t&&t.asBytes?r:t&&t.asString?b.bytesToString(r):y.bytesToHex(r)}})()},{charenc:2,crypt:3,"is-buffer":4}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.router=void 0;var n=e("apee-router");var o=e("./route/home");var a=e("./route/login");var i=e("./route/user");var s=e("./template");r.router=new n.Router;r.router.set(["home","add","list","tag","user","login"]);r.router.set("home",o.home);r.router.set("login",a.login);r.router.set("user",i.user);r.router.start();(0,a.checkLogin)();(0,s.loadTemplate)(r.router)},{"./route/home":7,"./route/login":8,"./route/user":9,"./template":10,"apee-router":1}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.home=void 0;var n=function(n){function e(){var t="";var e=n.dom.querySelector(".btn-list");if(!e)throw new Error(".btn-list 元素不存在");var r=[["plus-square-dotted.svg","新增收藏","add"],["card-checklist.svg","收藏列表","list"],["tags.svg","标签列表","tag"],["person-gear.svg","个人中心","user"]];r.forEach(function(e){t+='\n                <div class="col-sm-6 col-lg-4 col-xl-3 mb-4">\n                    <div class="border border-3 shadow-sm rounded-4 card card-body\n                        hover-shadow flex-row align-items-center" onclick="location.hash=\'#/'.concat(e[2],'\'">\n                        <img src="/static/img/').concat(e[0],'" class="mx-3 size-32">\n                        <div class="fs-4">').concat(e[1],"</div>\n                    </div>\n                </div>")});e.innerHTML=t}if(n.status==0){n.status=1;e()}};r.home=n},{}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.login=r.checkLogin=void 0;var a=e("..");var s=e("md5");var u=e("../util");function i(e){function t(){var e=a.router.getNowRouteName();if(e!="login")location.hash="/login";return false}function r(){var e=a.router.getNowRouteName();if(e=="login")location.hash="";return true}if(typeof e=="undefined")addEventListener("hashchange",i);var n=localStorage.getItem("expires");var o=(new Date).getTime();if(!n||parseInt(n)<o)return t();return r()}r.checkLogin=i;var n=document.querySelector(".login-box");var c={username:n.querySelector(".input-username"),password:n.querySelector(".input-password"),verCode:n.querySelector(".input-vercode"),getVerCode:n.querySelector(".get-vercode"),login:n.querySelector(".click-login")};var o=document.querySelector(".register-box");var l={username:o.querySelector(".input-username"),password:o.querySelector(".input-password"),repeatPassword:o.querySelector(".input-repeat-password"),email:o.querySelector(".input-email"),verCode:o.querySelector(".input-vercode"),getVerCode:o.querySelector(".get-vercode"),register:o.querySelector(".click-register")};var f=function(e){if(e.args[0]=="register"){n.style.display="none";o.style.display="block"}else{n.style.display="block";o.style.display="none"}if(e.status==0){e.status=1;l.register.addEventListener("click",h);l.getVerCode.addEventListener("click",function(){var e=l.email.value;if(!(0,u.checkEmail)(e))return alert("输入的邮箱格式错误，请检查后重新输入");v(l,e)});c.login.addEventListener("click",d);c.getVerCode.addEventListener("click",function(){var e=c.username.value;if(!e.match(/^\w{4,20}$/)&&!(0,u.checkEmail)(e))return alert("用户名或邮箱格式错误");v(c,e,true)})}};r.login=f;function d(){var e=c.username.value;var t=c.password.value;var r=c.verCode.value;if(!e.match(/^\w{4,20}$/)&&!(0,u.checkEmail)(e))return alert("用户名或邮箱格式错误");if(!t.match(/^\S{6,20}$/))return alert("密码必须是 6-20 位字符串");if(r.match(/^\s*$/))return alert("验证码不能为空");var n=new XMLHttpRequest;n.open("POST","/api/login");n.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var o=new URLSearchParams;o.set("username",e);o.set("passwordMd5",s(t));o.set("verCode",r);n.send(o.toString());n.addEventListener("readystatechange",function(){if(n.status==200&&n.readyState==n.DONE){var e=JSON.parse(n.responseText);if(e.code==200){alert("登录成功");var t=e.data.expires;localStorage.setItem("expires",t);location.hash="";return}alert(e.msg)}})}function v(t,e,r){if(r===void 0){r=false}t.getVerCode.setAttribute("disabled","disabled");t.getVerCode.innerHTML="正在发送";function n(e){t.getVerCode.innerHTML="".concat(e," 秒")}function o(e){clearInterval(e);t.getVerCode.innerHTML="获取验证码";t.getVerCode.removeAttribute("disabled")}var a=new XMLHttpRequest;a.open("GET","/api/sendCode?to=".concat(e,"&login=").concat(r));a.send();a.addEventListener("readystatechange",function(){if(a.status==200&&a.readyState==a.DONE){var e=JSON.parse(a.responseText);if(e.code==200){var t=60;var r=setInterval(function(){n(t);if(t--==0)o(r)},1e3);return}o();alert(e.msg)}})}function h(){var e=l.username.value;var t=l.password.value;var r=l.repeatPassword.value;var n=l.verCode.value;var o=l.email.value;if(!e.match(/^\w{4,20}$/))return alert("用户名必须是 4-20 位的数字、字母、下划线任意组合");if(!t.match(/^\S{6,20}$/))return alert("密码必须是 6-20 位字符串");if(t!=r)return alert("两次输入的密码不一致，请检查后重新输入");if(!(0,u.checkEmail)(o))return alert("输入的邮箱格式错误，请检查后重新输入");if(n.match(/^\s*$/))return alert("验证码不能为空");var a=new XMLHttpRequest;a.open("POST","/api/register");a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var i=new URLSearchParams;i.set("username",e);i.set("passwordMd5",s(t));i.set("email",o);i.set("verCode",n);a.send(i.toString());a.addEventListener("readystatechange",function(){if(a.status==200&&a.readyState==a.DONE){var e=JSON.parse(a.responseText);if(e.code==200){alert("注册成功，即将自动登录");var t=e.data.expires;localStorage.setItem("expires",t);location.hash="";return}alert(e.msg)}})}},{"..":6,"../util":11,md5:5}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.user=void 0;var n=function(e){if(e.status==0){e.status=1;var t=e.dom.querySelector(".click-logout");t.addEventListener("click",function(){localStorage.removeItem("expires");location.href="/logout"})}};r.user=n},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.loadTemplate=void 0;function n(e){o(e);a()}r.loadTemplate=n;function o(e){var o=function(){if(e.hashChanged)history.back();else location.hash=""};document.querySelectorAll("back-nav").forEach(function(e){var t;var r=e.innerHTML;var n=document.createElement("div");n.classList.add("d-flex","mb-4","align-items-center");n.innerHTML='\n            <img src="/static/img/arrow-left-circle.svg" class="cursor-pointer size-32 back-btn">\n            <div class="fs-3 fw-bold ms-3">'.concat(r,"</div>");(t=n.querySelector(".back-btn"))===null||t===void 0?void 0:t.addEventListener("click",o);e.replaceWith(n)})}function a(){document.querySelectorAll("sub-title").forEach(function(e){var t=e.innerHTML;var r=document.createElement("div");r.classList.add("d-flex","mb-4","align-items-center");r.innerHTML='\n            <img src="/static/img/tags.svg" class="cursor-pointer size-20 back-btn">\n            <div class="fs-5 fw-bold ms-2">'.concat(t,"</div>");e.replaceWith(r)})}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.checkEmail=void 0;function n(e){return e.match(/^[\w.%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)}r.checkEmail=n},{}]},{},[6])})();